<!--Start of external scripts-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.2/TweenMax.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/ScrollMagic.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/animation.gsap.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/debug.addIndicators.js"></script>
<!--End of external scripts-->

<!--START OF VIDEO LAYER-->
<div id="triggerTop"></div>
<div class="videoLayer">
    <h1>Medical Expansion in Phoenix</h1>
    <video id="bgVideo" type="video/mp4" preload="auto" playsinline="true">
        <source src="videos/Wexford_De.mp4">
    </video>
</div>
<!--END OF VIDEO LAYER-->

<!--START OF TEXT LAYER -->
<div class="text-box-container">
    <p class="text-box" id="overlay-text-wexford">This is Wexford Science Building, <br>located at 850 N 5th Street,
        Phoenix, Arizona
    </p>
    <p class="text-box" id="overlay-text-wexford-02">This is the front side of the Wexford Building, it has 7 floors</p>
</div>
<!--END OF TEXT LAYER -->

<!-- Steyle Sheet -->
<link rel="stylesheet" type="text/css" href="css/style.css">

<script>
    //For screensize smaller than 1200px, load mobile video
    window.addEventListener("resize", switchBGVideo);

    function switchBGVideo() {
        var bgVideo = $("#bgVideo");
        var windowWidth = $(window).width();
        if (windowWidth < 1200) {
            bgVideo.attr("src", "videos/WexfordMo.mp4");
        }
        else {
            bgVideo.attr("src", "videos/WexfordDe.mp4");
        }
    }

    switchBGVideo();
    //END OF SECTION

    const videoLayer = document.querySelector('.videoLayer');
    const video = videoLayer.querySelector('video');

    // init controller
    let controller = new ScrollMagic.Controller();

    // build video scene
    let scene = new ScrollMagic.Scene({
        triggerElement: videoLayer,
        triggerHook: 0,
        offset: 0,
        duration: 9000
    })
        // .addIndicators({ name: "--- videoPlayer" })
        .setPin(videoLayer)
        .addTo(controller);

    //Creating Video Animation
    let accelamount = 0.2;
    // to decrease delay effect, increase the number
    let scrollpos = 0;
    let delay = 0;
    let frameRate = 30;

    scene.on('update', e => {
        scrollpos = e.scrollPos / 1000;
        //video.currentTime = e.scrollPos * (video duration/duration)
        console.log("e.scrollPos / 1000 =" + e.scrollPos / 1000);
        console.log("scrollPos =" + e.scrollPos);
        //e.scrollPos comes from Scroll Magic and it is connect with the duration
    });

    setInterval(() => {
        delay += (scrollpos - delay) * accelamount;
        console.log(scrollpos, delay);

        video.currentTime = delay;
        console.log('video current time =' + video.currentTime);
    }, 1000 / frameRate);
    // video.currentTime indicates the position for the playback of the video, in seconds

    // h1 (Medical Expansion in Phoenix) Animation
    const h1Title = videoLayer.querySelector('h1');
    const textAnim = TweenMax.fromTo(h1Title, 3, { opacity: 1 }, { opacity: 0 });

    // textLayer.h1
    let scene2 = new ScrollMagic.Scene({
        duration: 800,
        triggerElement: videoLayer,
        triggerHook: 0
    })
        .setTween(textAnim)
        // .addIndicators({ name: "--- h1 Title" })
        .addTo(controller);

    // textLayer.overlayText01 pin and scroll up
    let scene3 = new ScrollMagic.Scene({
        duration: 4630,
        triggerElement: "#overlay-text-wexford",
        triggerHook: 1,
    })
        // .addIndicators({ name: "--- Wexford Layer" })
        .setPin('#overlay-text-wexford')
        .addTo(controller);

    let scene4 = new ScrollMagic.Scene({
        offset: 4630,
        duration: 2000,
        triggerElement: "#overlay-text-wexford",
        triggerHook: 0.4,
    })
        //.addIndicators({ name: "--- scene 5 Wexford Layer" })
        .setPin('#overlay-text-wexford')
        .addTo(controller);

    // textLayer.overlayText02 pin and scroll up
    let scene5 = new ScrollMagic.Scene({
        duration: 5000,
        triggerElement: "#overlay-text-wexford-02",
        triggerHook: 1,
    })
        //.addIndicators({ name: "--- overlay-text-02" })
        .setPin('#overlay-text-wexford-02')
        .addTo(controller);

    let scene6 = new ScrollMagic.Scene({
        offset: 5000,
        duration: 2000,
        triggerElement: "#overlay-text-wexford-02",
        triggerHook: 0.6,
    })
        //.addIndicators({ name: "--- overlay-text-wexford-02" })
        .setPin('#overlay-text-wexford-02')
        .addTo(controller);
</script>